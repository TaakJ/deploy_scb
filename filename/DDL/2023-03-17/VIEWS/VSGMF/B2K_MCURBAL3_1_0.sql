CREATE OR REPLACE VIEW P1VSGMF.B2K_MCURBAL3_1_0 (
  EDW_RECORD_NO,
  BCMU_ATH_CORPORATION_NUMBER,
  BCMU_ATH_ACCOUNT_NO1,
  BCMU_ATH_RECORD_TYPE,
  BCMU_ATH_CARD_ACCOUNT_NO1,
  BCMU_ATH_DT,
  BCMU_ATH_TM,
  BCMU_ATH_AUTH_NUMBER,
  BCMU_ATH_TRAN_ID,
  BCMU_ATH_CURR_CODE,
  BCMU_ATH_AMT,
  BCMU_ATH_MULTI_CURR_AMT,
  BCMU_ATH_POS_IND,
  BCMU_ATH_FEE_AMT,
  BCMU_ATH_MULTI_CURR_FEE_AMT,
  BCMU_ATH_MULTI_CURR_FEE_TYPE,
  BCMU_ATH_STATUS,
  BCMU_ATH_PRE_AUTH_IND,
  BCMU_ATH_EXTENDED_PROC_IND,
  BCMU_ATH_REV_DT,
  BCMU_ATH_REV_TM,
  BCMU_ATH_TRAN_TYPE_IND,
  START_DT,
  END_DT,
  RECORD_DELETED_FLAG,
  CTL_ID,
  INS_PROC_NAME,
  INS_TXF_BATCHID,
  UPD_PROC_NAME,
  UPD_TXF_BATCHID,
  TRANSACTION_DATE)
AS SELECT 
STGMERGE.EDW_RECORD_NO,
STGMERGE.BCMU_ATH_CORPORATION_NUMBER,
STGMERGE.BCMU_ATH_ACCOUNT_NO1,
STGMERGE.BCMU_ATH_RECORD_TYPE,
STGMERGE.BCMU_ATH_CARD_ACCOUNT_NO1,
STGMERGE.BCMU_ATH_DT,
STGMERGE.BCMU_ATH_TM,
STGMERGE.BCMU_ATH_AUTH_NUMBER,
STGMERGE.BCMU_ATH_TRAN_ID,
STGMERGE.BCMU_ATH_CURR_CODE,
STGMERGE.BCMU_ATH_AMT,
STGMERGE.BCMU_ATH_MULTI_CURR_AMT,
STGMERGE.BCMU_ATH_POS_IND,
STGMERGE.BCMU_ATH_FEE_AMT,
STGMERGE.BCMU_ATH_MULTI_CURR_FEE_AMT,
STGMERGE.BCMU_ATH_MULTI_CURR_FEE_TYPE,
STGMERGE.BCMU_ATH_STATUS,
STGMERGE.BCMU_ATH_PRE_AUTH_IND,
STGMERGE.BCMU_ATH_EXTENDED_PROC_IND,
STGMERGE.BCMU_ATH_REV_DT,
STGMERGE.BCMU_ATH_REV_TM,
STGMERGE.BCMU_ATH_TRAN_TYPE_IND,
STGMERGE.START_DT,
STGMERGE.END_DT,
STGMERGE.RECORD_DELETED_FLAG,
STGMERGE.CTL_ID,
STGMERGE.INS_PROC_NAME,
STGMERGE.INS_TXF_BATCHID,
STGMERGE.UPD_PROC_NAME,
STGMERGE.UPD_TXF_BATCHID,
COALESCE(DEFAULT_DATE,to_date('1000-01-02', 'yyyy-MM-dd')) as TRANSACTION_DATE
FROM  p1dutedw.CHAR_CALENDAR CC
RIGHT OUTER JOIN
(
    SELECT
    EDW_RECORD_NO,
    BCMU_ATH_CORPORATION_NUMBER,
    BCMU_ATH_ACCOUNT_NO1,
    BCMU_ATH_RECORD_TYPE,
    BCMU_ATH_CARD_ACCOUNT_NO1,
    BCMU_ATH_DT,
    BCMU_ATH_TM,
    BCMU_ATH_AUTH_NUMBER,
    BCMU_ATH_TRAN_ID,
    BCMU_ATH_CURR_CODE,
    BCMU_ATH_AMT,
    BCMU_ATH_MULTI_CURR_AMT,
    BCMU_ATH_POS_IND,
    BCMU_ATH_FEE_AMT,
    BCMU_ATH_MULTI_CURR_FEE_AMT,
    BCMU_ATH_MULTI_CURR_FEE_TYPE,
    BCMU_ATH_STATUS,
    BCMU_ATH_PRE_AUTH_IND,
    BCMU_ATH_EXTENDED_PROC_IND,
    BCMU_ATH_REV_DT,
    BCMU_ATH_REV_TM,
    BCMU_ATH_TRAN_TYPE_IND,
    START_DT,
    END_DT,
    RECORD_DELETED_FLAG,
    CTL_ID,
    INS_PROC_NAME,
    INS_TXF_BATCHID,
    UPD_PROC_NAME,
    UPD_TXF_BATCHID
    FROM p1dsgedw.B2K_MCURBAL3_1_0_T1
) STGMERGE

ON COALESCE(STGMERGE.BCMU_ATH_DT,'NA') = CC.CDT_YYYYMMDD
