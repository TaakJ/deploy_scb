CREATE OR REPLACE VIEW P1VSGMF.ATM_HPC_TRANSACTION_1_0 (
  edw_record_no,
  DAT_TIM,
  REC_TYP,
  AUTH_PPD,
  TERM_LN,
  TERM_FIID,
  TERM_ID,
  CRD_LN,
  CRD_FIID,
  CRD_PAN,
  CRD_MVR_NUM,
  BRCH_ID,
  REGN_ID,
  MACHINE_TYPE,
  AUTHX_TYP_CDE,
  AUTHX_TYP,
  AUTHX_RTE_STAT,
  AUTHX_ORIGINATOR,
  AUTHX_RESPONDER,
  AUTHX_ENTRY_TIM,
  AUTHX_EXIT_TIM,
  AUTHX_RE_ENTRY_TIM,
  AUTHX_TRAN_DAT_YMD,
  AUTHX_TRAN_TIM_HMS,
  AUTHX_TRAN_TIM_TT,
  AUTHX_POST_DAT_YMD,
  ACQ_ICHG_SETL_DAT_YMD,
  ISS_ICHG_SELT_DAT_YMD,
  SEQ_NUM,
  TERM_TYP,
  TIM_OFST,
  REFERENCE_NO_1,
  TRAN_CDE,
  TRAN_CDE_FRM,
  TRAN_CDE_TO,
  FROM_ACCT,
  SLIP_RECEIVED,
  TO_ACCT,
  MULT_ACCT,
  AMT_1,
  AMT_2,
  AMT_3,
  ATC_COUNTER,
  TERM_CABILITY,
  EMV_FLAG,
  RESP_BYTE_1,
  RESP_BYTE_2,
  TERM_NAME_LOC,
  TERM_OWNER_NAME,
  TERM_CITY,
  TERM_ST_X,
  TERM_CNTRY_X,
  TLF_TO_ACCT_FEE,
  TLF_ACQ_FEE,
  TLF_ISS_FEE,
  TLF_FILLER,
  ORIG_CRNCY_CDE,
  FROM_BANK_CODE,
  TO_BANK_CODE,
  PCC_TRACE_NO,
  TO_ACCT_NAME,
  RVSL_RSN,
  PIN_OFST,
  SHRG_GRP,
  DEST_ORDER,
  AUTH_ID_RESP,
  REFR_IMP_IND,
  REFR_AVAIL_IMP,
  REFR_LEDG_IMP,
  REFR_HLD_AMT_IMP,
  CAF_REFR_IND,
  REFR_USER_FLD3,
  DEP_SELT_IMP_FLG,
  ADI_SELT_IMP_FLG,
  REFR_IND_PRF1,
  REFR_IND_PRF2,
  REFR_IND_PBF3,
  REFR_IND_PBF4,
  FEE_AMT,
  COMMS_FEE,
  FROM_SUBTYPE,
  TO_SUBTYPE,
  BARCODE_TYPE,
  CDM_MONEY_CHANGE_TYPE,
  REFERENCE_NO_2,
  SCB_CARD_TYPE,
  SCB_SUB_CARD_TYPE,
  CRD_ISS_ID_NUM,
  TLF_HOPR1_AMT,
  TLF_HOPR2_AMT,
  TLF_HOPR3_AMT,
  TLF_HOPR4_AMT,
  BRANCH_FROM,
  BRANCH_TO,
  TRACK2,
  FAV_FLAG,
  ANY_ID_FLAG,
  PROXY_ID,
  PROXY_TYPE,
  ACQ_BANK,
  ISS_BANK,
  DEST_BANK,
  PIN_BLOCK_TYPE,
  TO_ACCT_DISP_NAME,
  TO_ACCT_NAME2,
  PROMPTCHAI_FLAG,
  SENDER_TAX_ID,
  RECEIVER_TAX_ID,
  VTM_HOPR1_AMT_0100,
  VTM_HOPR2_AMT_0500,
  VTM_HOPR3_AMT_1000,
  VTM_HOPR4_AMT_0020,
  VTM_HOPR5_AMT_0005,
  VTM_HOPR6_AMT_0001,
  P2P_BILLPAY_REF_NO_3,
  HAPPY_CASH_ID,
  WAIVE_FEE_FLAG,
  PROMPTCHAI_WAIVE_FEE_FLAG,
  PROMPTPAY_BILLPAY_NORM_FLAG,
  AMT_4,
  AMT_5,
  AMT_6,
  HAPPY_CASH_FLAG,
  TYPE_OF_SENDER,
  TYPE_OF_RECIEVER,
  CRD_NO_8DGT,
  START_DT,
  END_DT,
  RECORD_DELETED_FLAG,
  CTL_ID,
  INS_PROC_NAME,
  INS_TXF_BATCHID,
  UPD_PROC_NAME,
  UPD_TXF_BATCHID,
  BK_PARTY_125_001,
  BK_PARTY_125_002,
  BK_PARTY_126_001,
  BK_PARTY_126_002,
  BK_CARD_120_001,
  BK_PARTY_003_005,
  BK_PARTY_003_006,
  BK_LOCATION_124_001,
  TRANSACTION_DATE)
AS SELECT
STGMERGE.EDW_RECORD_NO
,STGMERGE.DAT_TIM
,STGMERGE.REC_TYP
,STGMERGE.AUTH_PPD
,STGMERGE.TERM_LN
,STGMERGE.TERM_FIID
,STGMERGE.TERM_ID
,STGMERGE.CRD_LN
,STGMERGE.CRD_FIID
,STGMERGE.CRD_PAN
,STGMERGE.CRD_MVR_NUM
,STGMERGE.BRCH_ID
,STGMERGE.REGN_ID
,STGMERGE.MACHINE_TYPE
,STGMERGE.AUTHX_TYP_CDE
,STGMERGE.AUTHX_TYP
,STGMERGE.AUTHX_RTE_STAT
,STGMERGE.AUTHX_ORIGINATOR
,STGMERGE.AUTHX_RESPONDER
,STGMERGE.AUTHX_ENTRY_TIM
,STGMERGE.AUTHX_EXIT_TIM
,STGMERGE.AUTHX_RE_ENTRY_TIM
,COALESCE(CC.DEFAULT_DATE,to_date('1000-01-03','yyyy-MM-dd')) AS AUTHX_TRAN_DAT_YMD /*D1*/
,STGMERGE.AUTHX_TRAN_TIM_HMS
,STGMERGE.AUTHX_TRAN_TIM_TT
,STGMERGE.AUTHX_POST_DAT_YMD /*D2*/
,STGMERGE.ACQ_ICHG_SETL_DAT_YMD /*D3*/
,STGMERGE.ISS_ICHG_SELT_DAT_YMD /*D4*/
,STGMERGE.SEQ_NUM
,STGMERGE.TERM_TYP
,STGMERGE.TIM_OFST
,STGMERGE.REFERENCE_NO_1
,STGMERGE.TRAN_CDE
,STGMERGE.TRAN_CDE_FRM
,STGMERGE.TRAN_CDE_TO
,STGMERGE.FROM_ACCT
,STGMERGE.SLIP_RECEIVED
,STGMERGE.TO_ACCT
,STGMERGE.MULT_ACCT
,STGMERGE.AMT_1
,STGMERGE.AMT_2
,STGMERGE.AMT_3
,STGMERGE.ATC_COUNTER
,STGMERGE.TERM_CABILITY
,STGMERGE.EMV_FLAG
,STGMERGE.RESP_BYTE_1
,STGMERGE.RESP_BYTE_2
,STGMERGE.TERM_NAME_LOC
,STGMERGE.TERM_OWNER_NAME
,STGMERGE.TERM_CITY
,STGMERGE.TERM_ST_X
,STGMERGE.TERM_CNTRY_X
,STGMERGE.TLF_TO_ACCT_FEE
,STGMERGE.TLF_ACQ_FEE
,STGMERGE.TLF_ISS_FEE
,STGMERGE.TLF_FILLER
,STGMERGE.ORIG_CRNCY_CDE
,STGMERGE.FROM_BANK_CODE
,STGMERGE.TO_BANK_CODE
,STGMERGE.PCC_TRACE_NO
,STGMERGE.TO_ACCT_NAME
,STGMERGE.RVSL_RSN
,STGMERGE.PIN_OFST
,STGMERGE.SHRG_GRP
,STGMERGE.DEST_ORDER
,STGMERGE.AUTH_ID_RESP
,STGMERGE.REFR_IMP_IND
,STGMERGE.REFR_AVAIL_IMP
,STGMERGE.REFR_LEDG_IMP
,STGMERGE.REFR_HLD_AMT_IMP
,STGMERGE.CAF_REFR_IND
,STGMERGE.REFR_USER_FLD3
,STGMERGE.DEP_SELT_IMP_FLG
,STGMERGE.ADI_SELT_IMP_FLG
,STGMERGE.REFR_IND_PRF1
,STGMERGE.REFR_IND_PRF2
,STGMERGE.REFR_IND_PBF3
,STGMERGE.REFR_IND_PBF4
,STGMERGE.FEE_AMT
,STGMERGE.COMMS_FEE
,STGMERGE.FROM_SUBTYPE
,STGMERGE.TO_SUBTYPE
,STGMERGE.BARCODE_TYPE
,STGMERGE.CDM_MONEY_CHANGE_TYPE
,STGMERGE.REFERENCE_NO_2
,STGMERGE.SCB_CARD_TYPE
,STGMERGE.SCB_SUB_CARD_TYPE
,STGMERGE.CRD_ISS_ID_NUM
,STGMERGE.TLF_HOPR1_AMT
,STGMERGE.TLF_HOPR2_AMT
,STGMERGE.TLF_HOPR3_AMT
,STGMERGE.TLF_HOPR4_AMT
,STGMERGE.BRANCH_FROM
,STGMERGE.BRANCH_TO
,STGMERGE.TRACK2
,STGMERGE.FAV_FLAG
,STGMERGE.ANY_ID_FLAG
,STGMERGE.PROXY_ID
,STGMERGE.PROXY_TYPE
,STGMERGE.ACQ_BANK
,STGMERGE.ISS_BANK
,STGMERGE.DEST_BANK
,STGMERGE.PIN_BLOCK_TYPE
,STGMERGE.TO_ACCT_DISP_NAME
,STGMERGE.TO_ACCT_NAME2
,STGMERGE.PROMPTCHAI_FLAG
,STGMERGE.SENDER_TAX_ID
,STGMERGE.RECEIVER_TAX_ID
,STGMERGE.VTM_HOPR1_AMT_0100
,STGMERGE.VTM_HOPR2_AMT_0500
,STGMERGE.VTM_HOPR3_AMT_1000
,STGMERGE.VTM_HOPR4_AMT_0020
,STGMERGE.VTM_HOPR5_AMT_0005
,STGMERGE.VTM_HOPR6_AMT_0001
,STGMERGE.P2P_BILLPAY_REF_NO_3
,STGMERGE.HAPPY_CASH_ID
,STGMERGE.WAIVE_FEE_FLAG
,STGMERGE.PROMPTCHAI_WAIVE_FEE_FLAG
,STGMERGE.PROMPTPAY_BILLPAY_NORM_FLAG
,STGMERGE.AMT_4
,STGMERGE.AMT_5
,STGMERGE.AMT_6
,STGMERGE.HAPPY_CASH_FLAG
,STGMERGE.TYPE_OF_SENDER
,STGMERGE.TYPE_OF_RECIEVER
,STGMERGE.CRD_NO_8DGT
,STGMERGE.START_DT
,STGMERGE.END_DT
,STGMERGE.RECORD_DELETED_FLAG
,STGMERGE.CTL_ID
,STGMERGE.INS_PROC_NAME
,STGMERGE.INS_TXF_BATCHID
,STGMERGE.UPD_PROC_NAME
,STGMERGE.UPD_TXF_BATCHID
,STGMERGE.BK_PARTY_125_001
,STGMERGE.BK_PARTY_125_002
,STGMERGE.BK_PARTY_126_001
,STGMERGE.BK_PARTY_126_002
,STGMERGE.BK_CARD_120_001
,STGMERGE.BK_PARTY_003_005
,STGMERGE.BK_PARTY_003_006
,STGMERGE.BK_LOCATION_124_001
,coalesce(default_date, to_date('1000-01-03','yyyy-MM-dd')) as TRANSACTION_DATE


from p1dutedw.char_calendar as cc
right join
(
select EDW_RECORD_NO
,DAT_TIM
,REC_TYP
,AUTH_PPD
,TERM_LN
,TERM_FIID
,TERM_ID
,CRD_LN
,CRD_FIID
,CRD_PAN
,CRD_MVR_NUM
,BRCH_ID
,REGN_ID
,MACHINE_TYPE
,AUTHX_TYP_CDE
,AUTHX_TYP
,AUTHX_RTE_STAT
,AUTHX_ORIGINATOR
,AUTHX_RESPONDER
,AUTHX_ENTRY_TIM
,AUTHX_EXIT_TIM
,AUTHX_RE_ENTRY_TIM
,AUTHX_TRAN_DAT_YMD
,AUTHX_TRAN_TIM_HMS
,AUTHX_TRAN_TIM_TT
,COALESCE(CDT2.DEFAULT_DATE,to_date('1000-01-03','yyyy-MM-dd')) AS AUTHX_POST_DAT_YMD /*D2*/
,COALESCE(CDT3.DEFAULT_DATE,to_date('1000-01-03','yyyy-MM-dd')) AS ACQ_ICHG_SETL_DAT_YMD /*D3*/
,COALESCE(CDT4.DEFAULT_DATE,to_date('1000-01-03','yyyy-MM-dd')) AS ISS_ICHG_SELT_DAT_YMD /*D4*/
,SEQ_NUM
,TERM_TYP
,TIM_OFST
,REFERENCE_NO_1
,TRAN_CDE
,TRAN_CDE_FRM
,TRAN_CDE_TO
,FROM_ACCT
,SLIP_RECEIVED
,TO_ACCT
,MULT_ACCT
,AMT_1
,AMT_2
,AMT_3
/*CODE ADDED FOR UR 58090052 - BALA*/
,ATC_COUNTER
,TERM_CABILITY
,EMV_FLAG
/*CODE ADD END FOR UR 58090052 - BALA*/
/*CODE COMMENTED FOR UR 58090052 - BALA
,DEP_BAL_CR
,DEP_TYP
CODE COMMENT END FOR UR 58090052 - BALA*/
,RESP_BYTE_1
,RESP_BYTE_2
,TERM_NAME_LOC
,TERM_OWNER_NAME
,TERM_CITY
,TERM_ST_X
,TERM_CNTRY_X
,TLF_TO_ACCT_FEE
,TLF_ACQ_FEE
,TLF_ISS_FEE
,TLF_FILLER
,ORIG_CRNCY_CDE
,FROM_BANK_CODE
,TO_BANK_CODE
,PCC_TRACE_NO
,TO_ACCT_NAME
,RVSL_RSN
,PIN_OFST
,SHRG_GRP
,DEST_ORDER
,AUTH_ID_RESP
,REFR_IMP_IND
,REFR_AVAIL_IMP
,REFR_LEDG_IMP
,REFR_HLD_AMT_IMP
,CAF_REFR_IND
,REFR_USER_FLD3
,DEP_SELT_IMP_FLG
,ADI_SELT_IMP_FLG
,REFR_IND_PRF1
,REFR_IND_PRF2
,REFR_IND_PBF3
,REFR_IND_PBF4
,FEE_AMT
,COMMS_FEE
,FROM_SUBTYPE
,TO_SUBTYPE
,BARCODE_TYPE
,CDM_MONEY_CHANGE_TYPE
,REFERENCE_NO_2
,FAV_FLAG
,SCB_CARD_TYPE
,SCB_SUB_CARD_TYPE
,CRD_ISS_ID_NUM
,TLF_HOPR1_AMT
,TLF_HOPR2_AMT
,TLF_HOPR3_AMT
,TLF_HOPR4_AMT
,BRANCH_FROM
,BRANCH_TO
,TRACK2
/* CODE ADDED FOR UR 59020090 - RAJAVEL */
,ANY_ID_FLAG
,PROXY_ID
,PROXY_TYPE
,ACQ_BANK
,ISS_BANK
,DEST_BANK
,PIN_BLOCK_TYPE
,TO_ACCT_DISP_NAME
,TO_ACCT_NAME2
/* CODE ADD END FOR UR 59020090 - RAJAVEL */
,START_DT
,END_DT
,RECORD_DELETED_FLAG
,CTL_ID
,INS_PROC_NAME
,INS_TXF_BATCHID
,UPD_PROC_NAME
,UPD_TXF_BATCHID
,BK_PARTY_125_001
,BK_PARTY_125_002
,BK_PARTY_126_001
,BK_PARTY_126_002
,BK_CARD_120_001
,BK_PARTY_003_005
,BK_PARTY_003_006
,BK_LOCATION_124_001
/* START CODE UR RP60030006 BALA */
,PROMPTCHAI_FLAG
,SENDER_TAX_ID
,RECEIVER_TAX_ID
/* END CODE UR RP60030006 BALA */
/* START CODE UR FEEL FREE BALA */
,VTM_HOPR1_AMT_0100
,VTM_HOPR2_AMT_0500
,VTM_HOPR3_AMT_1000
,VTM_HOPR4_AMT_0020
,VTM_HOPR5_AMT_0005
,VTM_HOPR6_AMT_0001
,P2P_BILLPAY_REF_NO_3
,HAPPY_CASH_ID
,WAIVE_FEE_FLAG
,PROMPTCHAI_WAIVE_FEE_FLAG
,PROMPTPAY_BILLPAY_NORM_FLAG
/* END CODE UR FEEL FREE BALA */
/* CODE ADDED FOR UR RP61080008 - PORNAPA */
,AMT_4
,AMT_5
,AMT_6
,HAPPY_CASH_FLAG
/* CODE ADDED FOR UR RP61080008 - PORNAPA */
/* CODE ADDED FOR UR PP62020001-02 KESSANEE*/
,TYPE_OF_SENDER
,TYPE_OF_RECIEVER
/* CODE ADDED FOR UR PP62020001-02 KESSANEE*/
, CRD_NO_8DGT
/* CODE ADDED FOR UR PP990071_01 BY KHANTIPOL */

FROM	p1dsgedw.ATM_HPC_TRANSACTION_1_0_T1   AS   T1
LEFT JOIN p1dutedw.CHAR_CALENDAR AS CDT2
ON     COALESCE(T1.AUTHX_POST_DAT_YMD,'NA') = CDT2.CDT_YYMMDD
LEFT JOIN p1dutedw.CHAR_CALENDAR AS CDT3
ON     COALESCE(T1.ACQ_ICHG_SETL_DAT_YMD,'NA') = CDT3.CDT_YYMMDD
LEFT JOIN p1dutedw.CHAR_CALENDAR AS CDT4
ON     COALESCE(T1.ISS_ICHG_SELT_DAT_YMD,'NA') = CDT4.CDT_YYMMDD
) STGMERGE

ON COALESCE(STGMERGE.AUTHX_TRAN_DAT_YMD,'NA') = CC.CDT_YYMMDD
