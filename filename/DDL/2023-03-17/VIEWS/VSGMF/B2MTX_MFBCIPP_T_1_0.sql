CREATE OR REPLACE VIEW P1VSGMF.B2MTX_MFBCIPP_T_1_0 (
  EDW_RECORD_NO,
  IPPLOG_RPT_TYPE,
  IPPLOG_RPT_MRCH_CORP_NO,
  IPPLOG_RPT_MRCH_NO,
  IPPLOG_RPT_MRCH_CARD_TYPE,
  IPPLOG_RPT_MRCH_TYPE_CODE,
  IPPLOG_RPT_TERMINAL_ID,
  IPPLOG_RPT_BATCH_NO,
  IPPLOG_RPT_BRANCH_NO,
  IPPLOG_RPT_REC_CONTROL,
  IPPLOG_RPT_CARD_NO,
  IPPLOG_RPT_MSG_TYPE,
  IPPLOG_RPT_TRAN_TYPE,
  IPPLOG_RPT_AUTH_CODE,
  IPPLOG_RPT_DATE,
  IPPLOG_RPT_TIME,
  IPPLOG_RPT_TR_AMT,
  IPPLOG_RPT_US_AMT,
  IPPLOG_TRACE_NO,
  IPPLOG_RPT_NET_OR_GROSS,
  IPPLOG_RPT_VSA_TYPE,
  IPPLOG_RPT_MCA_TYPE,
  IPPLOG_RPT_JCB_TYPE,
  IPPLOG_RPT_LOC_TYPE,
  IPPLOG_RPT_VSA_RATE,
  IPPLOG_RPT_MCA_RATE,
  IPPLOG_RPT_JCB_RATE,
  IPPLOG_RPT_LOC_RATE,
  IPPLOG_RPT_TERM_NAME,
  IPPLOG_RPT_POS_ENTRY,
  IPPLOG_RPT_MRCH_ACCT_NO,
  IPPLOG_RPT_MCA_AFF_TYPE,
  IPPLOG_RPT_MCA_AFF_RATE,
  IPPLOG_RPT_VSA_AFF_TYPE,
  IPPLOG_RPT_VSA_AFF_RATE,
  IPPLOG_RPT_AB_FLAG,
  IPPLOG_RPT_JCB_AFF_TYPE,
  IPPLOG_RPT_JCB_AFF_RATE,
  IPPLOG_RPT_GROUP_MRCH,
  IPPLOG_RPT_CODE_TEXT,
  IPPLOG_RPT_REUSE,
  IPPLOG_RPT_TODAY,
  IPPLOG_RPT_MCE_TYPE,
  IPPLOG_RPT_MCE_RATE,
  IPPLOG_RPT_GROUP_MRCH_NEW,
  IPPLOG_RPT_CURRENCY_CODE,
  IPPLOG_RPT_CURRENCY_NAME,
  IPPLOG_RPT_CURRENCY_AMT,
  IPPLOG_RPT_TVR,
  IPPLOG_RPT_MCC_FLAG,
  IPPLOG_RPT_ABS_FEE_AMT,
  IPPLOG_RPT_PAY_TERM,
  IPPLOG_RPT_VSP_ONUS_TYPE,
  IPPLOG_RPT_VSP_ONUS_RATE,
  IPPLOG_RPT_VSP_OFFUS_TYPE,
  IPPLOG_RPT_VSP_OFFUS_RATE,
  IPPLOG_RPT_MCP_ONUS_TYPE,
  IPPLOG_RPT_MCP_ONUS_RATE,
  IPPLOG_RPT_MCP_OFFUS_TYPE,
  IPPLOG_RPT_MCP_OFFUS_RATE,
  IPPLOG_RPT_FLAG_TYPE_IPP,
  FILLER,
  START_DT,
  END_DT,
  RECORD_DELETED_FLAG,
  CTL_ID,
  INS_PROC_NAME,
  INS_TXF_BATCHID,
  UPD_PROC_NAME,
  UPD_TXF_BATCHID,
  BK_PARTY_002_003,
  BM_M06150_001,
  BM_M12950_001,
  BM_M44477_01,
  TRANSACTION_DATE)
AS select 
STGMERGE.EDW_RECORD_NO,
STGMERGE.IPPLOG_RPT_TYPE,
STGMERGE.IPPLOG_RPT_MRCH_CORP_NO,
STGMERGE.IPPLOG_RPT_MRCH_NO,
STGMERGE.IPPLOG_RPT_MRCH_CARD_TYPE,
STGMERGE.IPPLOG_RPT_MRCH_TYPE_CODE,
STGMERGE.IPPLOG_RPT_TERMINAL_ID,
STGMERGE.IPPLOG_RPT_BATCH_NO,
STGMERGE.IPPLOG_RPT_BRANCH_NO,
STGMERGE.IPPLOG_RPT_REC_CONTROL,
STGMERGE.IPPLOG_RPT_CARD_NO,
STGMERGE.IPPLOG_RPT_MSG_TYPE,
STGMERGE.IPPLOG_RPT_TRAN_TYPE,
STGMERGE.IPPLOG_RPT_AUTH_CODE,
STGMERGE.IPPLOG_RPT_DATE,
STGMERGE.IPPLOG_RPT_TIME,
STGMERGE.IPPLOG_RPT_TR_AMT,
STGMERGE.IPPLOG_RPT_US_AMT,
STGMERGE.IPPLOG_TRACE_NO,
STGMERGE.IPPLOG_RPT_NET_OR_GROSS,
STGMERGE.IPPLOG_RPT_VSA_TYPE,
STGMERGE.IPPLOG_RPT_MCA_TYPE,
STGMERGE.IPPLOG_RPT_JCB_TYPE,
STGMERGE.IPPLOG_RPT_LOC_TYPE,
STGMERGE.IPPLOG_RPT_VSA_RATE,
STGMERGE.IPPLOG_RPT_MCA_RATE,
STGMERGE.IPPLOG_RPT_JCB_RATE,
STGMERGE.IPPLOG_RPT_LOC_RATE,
STGMERGE.IPPLOG_RPT_TERM_NAME,
STGMERGE.IPPLOG_RPT_POS_ENTRY,
STGMERGE.IPPLOG_RPT_MRCH_ACCT_NO,
STGMERGE.IPPLOG_RPT_MCA_AFF_TYPE,
STGMERGE.IPPLOG_RPT_MCA_AFF_RATE,
STGMERGE.IPPLOG_RPT_VSA_AFF_TYPE,
STGMERGE.IPPLOG_RPT_VSA_AFF_RATE,
STGMERGE.IPPLOG_RPT_AB_FLAG,
STGMERGE.IPPLOG_RPT_JCB_AFF_TYPE,
STGMERGE.IPPLOG_RPT_JCB_AFF_RATE,
STGMERGE.IPPLOG_RPT_GROUP_MRCH,
STGMERGE.IPPLOG_RPT_CODE_TEXT,
STGMERGE.IPPLOG_RPT_REUSE,
STGMERGE.IPPLOG_RPT_TODAY,
STGMERGE.IPPLOG_RPT_MCE_TYPE,
STGMERGE.IPPLOG_RPT_MCE_RATE,
STGMERGE.IPPLOG_RPT_GROUP_MRCH_NEW,
STGMERGE.IPPLOG_RPT_CURRENCY_CODE,
STGMERGE.IPPLOG_RPT_CURRENCY_NAME,
STGMERGE.IPPLOG_RPT_CURRENCY_AMT,
STGMERGE.IPPLOG_RPT_TVR,
STGMERGE.IPPLOG_RPT_MCC_FLAG,
STGMERGE.IPPLOG_RPT_ABS_FEE_AMT,
STGMERGE.IPPLOG_RPT_PAY_TERM,
STGMERGE.IPPLOG_RPT_VSP_ONUS_TYPE,
STGMERGE.IPPLOG_RPT_VSP_ONUS_RATE,
STGMERGE.IPPLOG_RPT_VSP_OFFUS_TYPE,
STGMERGE.IPPLOG_RPT_VSP_OFFUS_RATE,
STGMERGE.IPPLOG_RPT_MCP_ONUS_TYPE,
STGMERGE.IPPLOG_RPT_MCP_ONUS_RATE,
STGMERGE.IPPLOG_RPT_MCP_OFFUS_TYPE,
STGMERGE.IPPLOG_RPT_MCP_OFFUS_RATE,
STGMERGE.IPPLOG_RPT_FLAG_TYPE_IPP,
STGMERGE.FILLER,
STGMERGE.START_DT,
STGMERGE.END_DT,
STGMERGE.RECORD_DELETED_FLAG,
STGMERGE.CTL_ID,
STGMERGE.INS_PROC_NAME,
STGMERGE.INS_TXF_BATCHID,
STGMERGE.UPD_PROC_NAME,
STGMERGE.UPD_TXF_BATCHID,
(
COALESCE(TRIM(STGMERGE.IPPLOG_RPT_MRCH_CORP_NO),' ')
||'_'||COALESCE(TRIM(STGMERGE.IPPLOG_RPT_MRCH_NO),' ')
) AS BK_PARTY_002_003,
(
CASE WHEN STGMERGE.IPPLOG_RPT_TERMINAL_ID = '90199999'
     THEN 'Gateway'
     ELSE   'EDC'
     END
) AS BM_M06150_001,
STGMERGE.IPPLOG_RPT_TRAN_TYPE AS BM_M12950_001,
(
CASE WHEN SUBSTR(STGMERGE.IPPLOG_RPT_POS_ENTRY,1,2)='01'
     THEN 'Key-in'
     ELSE 'Card'
     END
) AS BM_M44477_01,
COALESCE(DEFAULT_DATE,to_date('1000-01-02', 'yyyy-MM-dd')) as TRANSACTION_DATE
FROM  p1dutedw.CHAR_CALENDAR CC
RIGHT OUTER JOIN
(
 SELECT
    EDW_RECORD_NO,
    IPPLOG_RPT_TYPE,
    IPPLOG_RPT_MRCH_CORP_NO,
    IPPLOG_RPT_MRCH_NO,
    IPPLOG_RPT_MRCH_CARD_TYPE,
    IPPLOG_RPT_MRCH_TYPE_CODE,
    IPPLOG_RPT_TERMINAL_ID,
    IPPLOG_RPT_BATCH_NO,
    IPPLOG_RPT_BRANCH_NO,
    IPPLOG_RPT_REC_CONTROL,
    IPPLOG_RPT_CARD_NO,
    IPPLOG_RPT_MSG_TYPE,
    IPPLOG_RPT_TRAN_TYPE,
    IPPLOG_RPT_AUTH_CODE,
    IPPLOG_RPT_DATE,
    IPPLOG_RPT_TIME,
    IPPLOG_RPT_TR_AMT,
    IPPLOG_RPT_US_AMT,
    IPPLOG_TRACE_NO,
    IPPLOG_RPT_NET_OR_GROSS,
    IPPLOG_RPT_VSA_TYPE,
    IPPLOG_RPT_MCA_TYPE,
    IPPLOG_RPT_JCB_TYPE,
    IPPLOG_RPT_LOC_TYPE,
    IPPLOG_RPT_VSA_RATE,
    IPPLOG_RPT_MCA_RATE,
    IPPLOG_RPT_JCB_RATE,
    IPPLOG_RPT_LOC_RATE,
    IPPLOG_RPT_TERM_NAME,
    IPPLOG_RPT_POS_ENTRY,
    IPPLOG_RPT_MRCH_ACCT_NO,
    IPPLOG_RPT_MCA_AFF_TYPE,
    IPPLOG_RPT_MCA_AFF_RATE,
    IPPLOG_RPT_VSA_AFF_TYPE,
    IPPLOG_RPT_VSA_AFF_RATE,
    IPPLOG_RPT_AB_FLAG,
    IPPLOG_RPT_JCB_AFF_TYPE,
    IPPLOG_RPT_JCB_AFF_RATE,
    IPPLOG_RPT_GROUP_MRCH,
    IPPLOG_RPT_CODE_TEXT,
    IPPLOG_RPT_REUSE,
    IPPLOG_RPT_TODAY,
    IPPLOG_RPT_MCE_TYPE,
    IPPLOG_RPT_MCE_RATE,
    IPPLOG_RPT_GROUP_MRCH_NEW,
    IPPLOG_RPT_CURRENCY_CODE,
    IPPLOG_RPT_CURRENCY_NAME,
    IPPLOG_RPT_CURRENCY_AMT,
    IPPLOG_RPT_TVR,
    IPPLOG_RPT_MCC_FLAG,
    IPPLOG_RPT_ABS_FEE_AMT,
    IPPLOG_RPT_PAY_TERM,
    IPPLOG_RPT_VSP_ONUS_TYPE,
    IPPLOG_RPT_VSP_ONUS_RATE,
    IPPLOG_RPT_VSP_OFFUS_TYPE,
    IPPLOG_RPT_VSP_OFFUS_RATE,
    IPPLOG_RPT_MCP_ONUS_TYPE,
    IPPLOG_RPT_MCP_ONUS_RATE,
    IPPLOG_RPT_MCP_OFFUS_TYPE,
    IPPLOG_RPT_MCP_OFFUS_RATE,
    IPPLOG_RPT_FLAG_TYPE_IPP,
    FILLER,
    START_DT,
    END_DT,
    RECORD_DELETED_FLAG,
    CTL_ID,
    INS_PROC_NAME,
    INS_TXF_BATCHID,
    UPD_PROC_NAME,
    UPD_TXF_BATCHID
 FROM p1dsgedw.B2MTX_MFBCIPP_T_1_0_T1
) STGMERGE

ON COALESCE(CAST('20'||IPPLOG_RPT_DATE as char(8)),'NA') = CC.CDT_YYYYMMDD
