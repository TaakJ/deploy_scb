CREATE OR REPLACE VIEW P1VSGMF.B2MTX_PCOEC_T_1_0 (
  EDW_RECORD_NO,
  PCOLE_REC_TYPE,
  PCOLE_CORP,
  PCOLE_BATCH_NUMBER,
  PCOLE_SEQUENCE,
  PCOLE_TRAN_ACCOUNT,
  PCOLE_ACNO_EXTENSION,
  PCOLE_TRAN_EXPIRY_DATE,
  PCOLE_TRAN_DATE,
  FILLER_1,
  PCOLE_TRAN_AUTH_NUMBER,
  PCOLE_TRAN_AMOUNT,
  PCOLE_TRAN_FILM_SEQ,
  PCOLE_TRAN_INSTLM_NUMBER,
  PCOLE_TRAN_ORIG_POST_DATE,
  FILLER_2,
  PCOLE_TRAN_DISPOSITION,
  PCOLE_TRAN_OPER,
  PCOLE_TRAN_TERM,
  PCOLE_TRAN_TIME,
  FILLER_3,
  START_DT,
  END_DT,
  RECORD_DELETED_FLAG,
  CTL_ID,
  INS_PROC_NAME,
  INS_TXF_BATCHID,
  UPD_PROC_NAME,
  UPD_TXF_BATCHID,
  TRANSACTION_DATE)
AS select 
STGMERGE.EDW_RECORD_NO,
STGMERGE.PCOLE_REC_TYPE,
STGMERGE.PCOLE_CORP,
LPAD(STGMERGE.PCOLE_BATCH_NUMBER, 5, '0') AS PCOLE_BATCH_NUMBER, 
STGMERGE.PCOLE_SEQUENCE,
STGMERGE.PCOLE_TRAN_ACCOUNT,
STGMERGE.PCOLE_ACNO_EXTENSION,
STGMERGE.PCOLE_TRAN_EXPIRY_DATE,
STGMERGE.PCOLE_TRAN_DATE,
STGMERGE.FILLER_1,
STGMERGE.PCOLE_TRAN_AUTH_NUMBER,
STGMERGE.PCOLE_TRAN_AMOUNT,
STGMERGE.PCOLE_TRAN_FILM_SEQ,
STGMERGE.PCOLE_TRAN_INSTLM_NUMBER,
STGMERGE.PCOLE_TRAN_ORIG_POST_DATE,
STGMERGE.FILLER_2,
STGMERGE.PCOLE_TRAN_DISPOSITION,
STGMERGE.PCOLE_TRAN_OPER,
STGMERGE.PCOLE_TRAN_TERM,
STGMERGE.PCOLE_TRAN_TIME,
STGMERGE.FILLER_3,
STGMERGE.START_DT,
STGMERGE.END_DT,
STGMERGE.RECORD_DELETED_FLAG,
STGMERGE.CTL_ID,
STGMERGE.INS_PROC_NAME,
STGMERGE.INS_TXF_BATCHID,
STGMERGE.UPD_PROC_NAME,
STGMERGE.UPD_TXF_BATCHID,
COALESCE(DEFAULT_DATE,to_date('1000-01-02', 'yyyy-MM-dd')) as TRANSACTION_DATE
FROM  p1dutedw.CHAR_CALENDAR CC
RIGHT OUTER JOIN
(
 SELECT
    EDW_RECORD_NO,
    PCOLE_REC_TYPE,
    PCOLE_CORP,
    PCOLE_BATCH_NUMBER,
    PCOLE_SEQUENCE,
    PCOLE_TRAN_ACCOUNT,
    PCOLE_ACNO_EXTENSION,
    PCOLE_TRAN_EXPIRY_DATE,
    PCOLE_TRAN_DATE,
    FILLER_1,
    PCOLE_TRAN_AUTH_NUMBER,
    PCOLE_TRAN_AMOUNT,
    PCOLE_TRAN_FILM_SEQ,
    PCOLE_TRAN_INSTLM_NUMBER,
    PCOLE_TRAN_ORIG_POST_DATE,
    FILLER_2,
    PCOLE_TRAN_DISPOSITION,
    PCOLE_TRAN_OPER,
    PCOLE_TRAN_TERM,
    PCOLE_TRAN_TIME,
    FILLER_3,
    START_DT,
    END_DT,
    RECORD_DELETED_FLAG,
    CTL_ID,
    INS_PROC_NAME,
    INS_TXF_BATCHID,
    UPD_PROC_NAME,
    UPD_TXF_BATCHID
 FROM p1dsgedw.B2MTX_PCOEC_T_1_0_T1
) STGMERGE

ON COALESCE(SUBSTR(PCOLE_TRAN_DATE,2),'NA') = CC.CDT_YYYYMMDD
