CREATE OR REPLACE VIEW P1VSGMF.B2K_BCPIHSST_1_0 (
  EDW_RECORD_NO,
  PIR_CORP,
  PIR_ACCOUNT,
  PIR_TRANS_CODE,
  PIR_REASON,
  PIR_POST_DT,
  PIR_PURCH_DT,
  PIR_AMT,
  PIR_ORIG_TRANS_AMT,
  PIR_ORIG_CURR_CODE,
  PIR_ORIG_CURR_EXP,
  PIR_REF_NO,
  PIR_SIC_CODE,
  PIR_MERCHANT_NAME,
  PIR_MERCHANT_CITY,
  PIR_MERCHANT_STATE_PROV,
  PIR_REIMB_ATTR,
  PIR_MAIL_PHONE_IND,
  PIR_AUTH_NUM,
  PIR_ONLINE_MON_IND,
  PIR_POS_ENTRY_MODE,
  BCPIH_SEG03_DATA_1,
  BCPIH_SEG03_WALLET_ID,
  BCPIH_SEG03_DATA_2,
  BCPIH_SEG04_DATA_1,
  BCPIH_SEG04_TRID,
  BCPIH_SEG04_DATA_2,
  BCPIH_SEG06_POS_DATA_CODE_1,
  BCPIH_SEG06_POS_MC_CNTACTLESS,
  BCPIH_SEG06_POS_DATA_CODE_2,
  PIR_CARDHOLDER_ACTIV_TERMINAL,
  PIR_MERCHANT_CORP,
  PIR_MERCHANT_NO,
  PIR_GL_REJ_CODE,
  PIR_MERCHANT_COUNTRY_CODE,
  POST_TRANS_PROGRAM_ID,
  BIN_8_DIGIT,
  START_DT,
  END_DT,
  RECORD_DELETED_FLAG,
  CTL_ID,
  INS_PROC_NAME,
  INS_TXF_BATCHID,
  UPD_PROC_NAME,
  UPD_TXF_BATCHID,
  TRANSACTION_DATE)
AS SELECT 
STGMERGE.EDW_RECORD_NO ,
STGMERGE.PIR_CORP,
STGMERGE.PIR_ACCOUNT,
STGMERGE.PIR_TRANS_CODE,
STGMERGE.PIR_REASON,
STGMERGE.PIR_POST_DT,
STGMERGE.PIR_PURCH_DT,
STGMERGE.PIR_AMT,
STGMERGE.PIR_ORIG_TRANS_AMT,
STGMERGE.PIR_ORIG_CURR_CODE,
STGMERGE.PIR_ORIG_CURR_EXP,
STGMERGE.PIR_REF_NO,
STGMERGE.PIR_SIC_CODE,
STGMERGE.PIR_MERCHANT_NAME,
STGMERGE.PIR_MERCHANT_CITY,
STGMERGE.PIR_MERCHANT_STATE_PROV,
STGMERGE.PIR_REIMB_ATTR,
STGMERGE.PIR_MAIL_PHONE_IND,
STGMERGE.PIR_AUTH_NUM,
STGMERGE.PIR_ONLINE_MON_IND,
STGMERGE.PIR_POS_ENTRY_MODE,
STGMERGE.BCPIH_SEG03_DATA_1,
STGMERGE.BCPIH_SEG03_WALLET_ID,
STGMERGE.BCPIH_SEG03_DATA_2 ,
STGMERGE.BCPIH_SEG04_DATA_1,
STGMERGE.BCPIH_SEG04_TRID  ,
STGMERGE.BCPIH_SEG04_DATA_2,
STGMERGE.BCPIH_SEG06_POS_DATA_CODE_1,
STGMERGE.BCPIH_SEG06_POS_MC_CNTACTLESS ,
STGMERGE.BCPIH_SEG06_POS_DATA_CODE_2,
STGMERGE.PIR_CARDHOLDER_ACTIV_TERMINAL,
STGMERGE.PIR_MERCHANT_CORP,
STGMERGE.PIR_MERCHANT_NO,
STGMERGE.PIR_GL_REJ_CODE,
STGMERGE.PIR_MERCHANT_COUNTRY_CODE,
STGMERGE.POST_TRANS_PROGRAM_ID,
STGMERGE.BIN_8_DIGIT,
STGMERGE.START_DT,
STGMERGE.END_DT,
STGMERGE.RECORD_DELETED_FLAG,
STGMERGE.CTL_ID,
STGMERGE.INS_PROC_NAME,
STGMERGE.INS_TXF_BATCHID,
STGMERGE.UPD_PROC_NAME,
STGMERGE.UPD_TXF_BATCHID,
COALESCE(DEFAULT_DATE,to_date('1000-01-02', 'yyyy-MM-dd')) as TRANSACTION_DATE
FROM  p1dutedw.CHAR_CALENDAR CC
RIGHT OUTER JOIN
(
    SELECT	EDW_RECORD_NO,
    PIR_CORP,
    PIR_ACCOUNT,
    PIR_TRANS_CODE,
    PIR_REASON,
    PIR_POST_DT,
    PIR_PURCH_DT,
    PIR_AMT,
    PIR_ORIG_TRANS_AMT,
    PIR_ORIG_CURR_CODE,
    PIR_ORIG_CURR_EXP,
    PIR_REF_NO,
    PIR_SIC_CODE,
    PIR_MERCHANT_NAME,
    PIR_MERCHANT_CITY,
    PIR_MERCHANT_STATE_PROV,
    PIR_REIMB_ATTR,
    PIR_MAIL_PHONE_IND,
    PIR_AUTH_NUM,
    PIR_ONLINE_MON_IND,
    PIR_POS_ENTRY_MODE,
    BCPIH_SEG03_DATA_1,
    BCPIH_SEG03_WALLET_ID ,
    BCPIH_SEG03_DATA_2,
    BCPIH_SEG04_DATA_1,
    BCPIH_SEG04_TRID,
    BCPIH_SEG04_DATA_2,
    BCPIH_SEG06_POS_DATA_CODE_1,
    BCPIH_SEG06_POS_MC_CNTACTLESS ,
    BCPIH_SEG06_POS_DATA_CODE_2 ,
    PIR_CARDHOLDER_ACTIV_TERMINAL,
    PIR_MERCHANT_CORP,
    PIR_MERCHANT_NO,
    PIR_GL_REJ_CODE,
    PIR_MERCHANT_COUNTRY_CODE,
    POST_TRANS_PROGRAM_ID,
    BIN_8_DIGIT,
    START_DT,
    END_DT,
    RECORD_DELETED_FLAG,
    CTL_ID,
    INS_PROC_NAME,
    INS_TXF_BATCHID,
    UPD_PROC_NAME,
    UPD_TXF_BATCHID 
    FROM p1dsgedw.B2K_BCPIHSST_1_0_T1
) STGMERGE

ON COALESCE(SUBSTR(STGMERGE.PIR_PURCH_DT,2),'NA') = CC.CDT_YYYYMMDD
