CREATE OR REPLACE VIEW P1VSGMF.B2MTX_MFBC032_T_ND_1_0 (
  EDW_RECORD_NO,
  LOG_REPORT_TYPE,
  LOG_REPORT_MRCH_CORP_NO,
  LOG_REPORT_MRCH_NO,
  LOG_REPORT_MRCH_CARD_TYPE,
  LOG_REPORT_MRCH_TYPE_CODE,
  LOG_REPORT_TERMINAL_ID,
  LOG_REPORT_BATCH_NO,
  LOG_REPORT_BRANCH_NO,
  LOG_REPORT_REC_CONTROL,
  LOG_REPORT_CARD_NO,
  LOG_REPORT_MSG_TYPE,
  LOG_REPORT_TRAN_TYPE,
  LOG_REPORT_AUTH_CODE,
  LOG_REPORT_DATE,
  LOG_REPORT_TIME,
  LOG_TR_AMT,
  LOG_US_AMT,
  LOG_TRACE_NO,
  LOG_REPORT_NET_OR_GROSS,
  LOG_REPORT_VSA_TYPE,
  LOG_REPORT_MCA_TYPE,
  LOG_REPORT_JCB_TYPE,
  LOG_REPORT_LOC_TYPE,
  LOG_REPORT_VSA_RATE,
  LOG_REPORT_MCA_RATE,
  LOG_REPORT_JCB_RATE,
  LOG_REPORT_LOC_RATE,
  LOG_REPORT_TERM_NAME,
  LOG_REPORT_POS_ENTRY,
  LOG_REPORT_MRCH_ACCT_NO,
  LOG_REPORT_MCA_AFF_TYPE,
  LOG_REPORT_MCA_AFF_RATE,
  LOG_REPORT_VSA_AFF_TYPE,
  LOG_REPORT_VSA_AFF_RATE,
  LOG_REPORT_AB_FLAG,
  LOG_REPORT_JCB_AFF_TYPE,
  LOG_REPORT_JCB_AFF_RATE,
  LOG_REPORT_GROUP_MRCH,
  LOG_REPORT_CODE_TEXT,
  LOG_REPORT_REUSE,
  LOG_REPORT_UNPOST_ATS,
  LOG_REPORT_TODAY_BILL,
  LOG_REPORT_MCE_TYPE,
  LOG_REPORT_MCE_RATE,
  LOG_REPORT_GROUP_MRCH_NEW,
  LOG_REPORT_CURRENCY_CODE,
  LOG_REPORT_CURRENCY_NAME,
  LOG_REPORT_CURRENCY_AMT,
  LOG_REPORT_TVR,
  LOG_REPORT_MCC_FLAG,
  LOG_FILLER_1,
  START_DT,
  END_DT,
  RECORD_DELETED_FLAG,
  CTL_ID,
  INS_PROC_NAME,
  INS_TXF_BATCHID,
  UPD_PROC_NAME,
  UPD_TXF_BATCHID,
  BK_PARTY_002_06,
  BM_M06150_002,
  BM_M12950_004,
  BM_M44477_004,
  TRANSACTION_DATE)
AS select 
STGMERGE.EDW_RECORD_NO,
STGMERGE.LOG_REPORT_TYPE,
STGMERGE.LOG_REPORT_MRCH_CORP_NO,
STGMERGE.LOG_REPORT_MRCH_NO,
STGMERGE.LOG_REPORT_MRCH_CARD_TYPE,
STGMERGE.LOG_REPORT_MRCH_TYPE_CODE,
STGMERGE.LOG_REPORT_TERMINAL_ID,
STGMERGE.LOG_REPORT_BATCH_NO,
STGMERGE.LOG_REPORT_BRANCH_NO,
STGMERGE.LOG_REPORT_REC_CONTROL,
STGMERGE.LOG_REPORT_CARD_NO,
STGMERGE.LOG_REPORT_MSG_TYPE,
STGMERGE.LOG_REPORT_TRAN_TYPE,
STGMERGE.LOG_REPORT_AUTH_CODE,
STGMERGE.LOG_REPORT_DATE,
STGMERGE.LOG_REPORT_TIME,
STGMERGE.LOG_TR_AMT,
STGMERGE.LOG_US_AMT,
STGMERGE.LOG_TRACE_NO,
STGMERGE.LOG_REPORT_NET_OR_GROSS,
STGMERGE.LOG_REPORT_VSA_TYPE,
STGMERGE.LOG_REPORT_MCA_TYPE,
STGMERGE.LOG_REPORT_JCB_TYPE,
STGMERGE.LOG_REPORT_LOC_TYPE,
STGMERGE.LOG_REPORT_VSA_RATE,
STGMERGE.LOG_REPORT_MCA_RATE,
STGMERGE.LOG_REPORT_JCB_RATE,
STGMERGE.LOG_REPORT_LOC_RATE,
STGMERGE.LOG_REPORT_TERM_NAME,
STGMERGE.LOG_REPORT_POS_ENTRY,
STGMERGE.LOG_REPORT_MRCH_ACCT_NO,
STGMERGE.LOG_REPORT_MCA_AFF_TYPE,
STGMERGE.LOG_REPORT_MCA_AFF_RATE,
STGMERGE.LOG_REPORT_VSA_AFF_TYPE,
STGMERGE.LOG_REPORT_VSA_AFF_RATE,
STGMERGE.LOG_REPORT_AB_FLAG,
STGMERGE.LOG_REPORT_JCB_AFF_TYPE,
STGMERGE.LOG_REPORT_JCB_AFF_RATE,
STGMERGE.LOG_REPORT_GROUP_MRCH,
STGMERGE.LOG_REPORT_CODE_TEXT,
STGMERGE.LOG_REPORT_REUSE,
STGMERGE.LOG_REPORT_UNPOST_ATS,
STGMERGE.LOG_REPORT_TODAY_BILL,
STGMERGE.LOG_REPORT_MCE_TYPE,
STGMERGE.LOG_REPORT_MCE_RATE,
STGMERGE.LOG_REPORT_GROUP_MRCH_NEW,
STGMERGE.LOG_REPORT_CURRENCY_CODE,
STGMERGE.LOG_REPORT_CURRENCY_NAME,
STGMERGE.LOG_REPORT_CURRENCY_AMT,
STGMERGE.LOG_REPORT_TVR,
STGMERGE.LOG_REPORT_MCC_FLAG,
STGMERGE.LOG_FILLER_1,
STGMERGE.START_DT,
STGMERGE.END_DT,
STGMERGE.RECORD_DELETED_FLAG,
STGMERGE.CTL_ID,
STGMERGE.INS_PROC_NAME,
STGMERGE.INS_TXF_BATCHID,
STGMERGE.UPD_PROC_NAME,
STGMERGE.UPD_TXF_BATCHID,
(
COALESCE(TRIM(STGMERGE.LOG_REPORT_MRCH_CORP_NO),' ')
||'_'||COALESCE(TRIM(STGMERGE.LOG_REPORT_MRCH_NO),' ')
) AS BK_PARTY_002_06,
(
CASE WHEN SUBSTR(STGMERGE.LOG_REPORT_TERMINAL_ID,1,3) IN ('912','913')
     THEN 'mPOS'
     ELSE 'EDC'
     END 
) AS BM_M06150_002,
STGMERGE.LOG_REPORT_TRAN_TYPE AS BM_M12950_004,
(
CASE WHEN SUBSTR(STGMERGE.LOG_REPORT_POS_ENTRY,1,2)='01'
     THEN 'Key-in'
     ELSE 'Card'
     END 
) AS BM_M44477_004,
COALESCE(DEFAULT_DATE,to_date('1000-01-02', 'yyyy-MM-dd')) as TRANSACTION_DATE
FROM  p1dutedw.CHAR_CALENDAR CC
RIGHT OUTER JOIN
(
 SELECT
    EDW_RECORD_NO,
    LOG_REPORT_TYPE,
    LOG_REPORT_MRCH_CORP_NO,
    LOG_REPORT_MRCH_NO,
    LOG_REPORT_MRCH_CARD_TYPE,
    LOG_REPORT_MRCH_TYPE_CODE,
    LOG_REPORT_TERMINAL_ID,
    LOG_REPORT_BATCH_NO,
    LOG_REPORT_BRANCH_NO,
    LOG_REPORT_REC_CONTROL,
    LOG_REPORT_CARD_NO,
    LOG_REPORT_MSG_TYPE,
    LOG_REPORT_TRAN_TYPE,
    LOG_REPORT_AUTH_CODE,
    LOG_REPORT_DATE,
    LOG_REPORT_TIME,
    LOG_TR_AMT,
    LOG_US_AMT,
    LOG_TRACE_NO,
    LOG_REPORT_NET_OR_GROSS,
    LOG_REPORT_VSA_TYPE,
    LOG_REPORT_MCA_TYPE,
    LOG_REPORT_JCB_TYPE,
    LOG_REPORT_LOC_TYPE,
    LOG_REPORT_VSA_RATE,
    LOG_REPORT_MCA_RATE,
    LOG_REPORT_JCB_RATE,
    LOG_REPORT_LOC_RATE,
    LOG_REPORT_TERM_NAME,
    LOG_REPORT_POS_ENTRY,
    LOG_REPORT_MRCH_ACCT_NO,
    LOG_REPORT_MCA_AFF_TYPE,
    LOG_REPORT_MCA_AFF_RATE,
    LOG_REPORT_VSA_AFF_TYPE,
    LOG_REPORT_VSA_AFF_RATE,
    LOG_REPORT_AB_FLAG,
    LOG_REPORT_JCB_AFF_TYPE,
    LOG_REPORT_JCB_AFF_RATE,
    LOG_REPORT_GROUP_MRCH,
    LOG_REPORT_CODE_TEXT,
    LOG_REPORT_REUSE,
    LOG_REPORT_UNPOST_ATS,
    LOG_REPORT_TODAY_BILL,
    LOG_REPORT_MCE_TYPE,
    LOG_REPORT_MCE_RATE,
    LOG_REPORT_GROUP_MRCH_NEW,
    LOG_REPORT_CURRENCY_CODE,
    LOG_REPORT_CURRENCY_NAME,
    LOG_REPORT_CURRENCY_AMT,
    LOG_REPORT_TVR,
    LOG_REPORT_MCC_FLAG,
    LOG_FILLER_1,
    START_DT,
    END_DT,
    RECORD_DELETED_FLAG,
    CTL_ID,
    INS_PROC_NAME,
    INS_TXF_BATCHID,
    UPD_PROC_NAME,
    UPD_TXF_BATCHID
 FROM p1dsgedw.B2MTX_MFBC032_T_ND_1_0_T1
) STGMERGE

ON COALESCE(CAST('20'||LOG_REPORT_DATE as char(8)),'NA') = CC.CDT_YYYYMMDD
